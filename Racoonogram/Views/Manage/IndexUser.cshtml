@model Racoonogram.Models.UserAndImagesAndPlans
@using Racoonogram.Models


<section>
    <div class="container">

        <div class="row">

            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#Main">Главная</a></li>
                <li><a id="img-tab" data-toggle="tab" href="#Images">Изображения</a></li>
                <li><a id="plans-tab" data-toggle="tab" href="#Plans">Планы</a></li>
                <li><a data-toggle="tab" href="#Profile">Профиль</a></li>

            </ul>

            <div class="tab-content">
                <div id="Main" class="tab-pane fade in active">
                    <div class="row">
                        <div class="col-xs-4 href-user-index">
                            <div>
                                <h4>Планы для изображений</h4>
                                <p>Миллионы качественных стоковых фото для ваших творческих идей.</p>
                            </div>
                             
                            <a href="/home/BuyPlan">Купить</a>
                        </div>
                        <div class="col-xs-4 href-user-index">
                            <div>
                                <h4>Больше бесплатных фотографий</h4>
                                <p>Новые бесплатные изображения для вдохновения в одном месте.</p>
                            </div>

                            <a href="/home/photogalery">Посмотреть</a>
                        </div>
                        <div class="col-xs-4 href-user-index">
                            <div>
                                <h4>Нужна помощь?</h4>
                                <p>Мы с радостью поможем Вам освоиться в нашем сервисе и ответим на все Ваши вопросы.</p>
                            </div>

                            <a href="#">Заказать звонок</a>
                        </div>

                    </div>
                    <br /><br /><br />
                                <div class="row">
                                    <div class="col-sm-10">
                                        <div style="width:100%;text-align:center">
                                            <br />
                                            <h4>Лучшие подборки</h4>
                                            <p>Самые актуальные и интересные коллекции фотоснимков</p>

                                            <!-- Wrapper for slides -->
                                            <table class="table-u-1" style="width:100%" table-layout="fixed">
                                                <tr>
                                                    <td class="col-xs-2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img src="~/Content/Collections/best_1(1).jpg" onerror="this.src='/Content/Images/notFound.jpg'"/>
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="col-xs-2" rowspan="2" colspan="2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img style="height:200px" src="~/Content/Collections/best_1(2).jpg" onerror="this.src='/Content/Images/notFound.jpg'" />
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="col-xs-2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img src="~/Content/Collections/best_1(3).jpg" onerror="this.src='/Content/Images/notFound.jpg'"/>
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="col-xs-2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img src="~/Content/Collections/best_1(4).jpg" onerror="this.src='/Content/Images/notFound.jpg'"/>
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="col-xs-2" rowspan="2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img style="height:200px" src="~/Content/Collections/best_1(5).jpg" onerror="this.src='/Content/Images/notFound.jpg'"/>
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="col-xs-2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img src="~/Content/Collections/best_1(6).jpg" onerror="this.src='/Content/Images/notFound.jpg'" />
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="col-xs-2" colspan="2">
                                                        <div>
                                                            <a href="/Home/PhotoGalery?category=">
                                                                <img src="~/Content/Collections/best_1(7).jpg" onerror="this.src='/Content/Images/notFound.jpg'" />
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>


                                        </div>
                                        <div style="text-align:center">
                                            <hr />
                                            <br />
                                            <h4>Самые новые изображения</h4>
                                            <p>Получай все самое свежее</p>


                                            <div id="myCarouselUserPres" class="carousel slide" data-ride="carousel">
                                                <!-- Indicators -->
                                                <ol class="carousel-indicators" style="bottom: -30px;">
                                                    <li data-target="#myCarouselUserPres" data-slide-to="0" style="border: 2px solid #444;" class="active"></li>
                                                    <li data-target="#myCarouselUserPres" data-slide-to="1" style="border: 2px solid #444;"></li>

                                                </ol>

                                                <!-- Wrapper for slides -->
                                                <div class="carousel-inner">
                                                    <div class="item active">
                                                        @foreach (var item in Model.ImNews1)
	                                                        {
                                                        <div class="col-xs-3">
                                                            <div>
                                                                <a href="/Home/imagePreview/@item.Id">
                                                                    <img src="~/Content/Content-image/@item.Url" onerror="this.src='/Content/Images/notFound.jpg'" />
                                                                </a>
                                                            </div>
                                                        </div>
	                                                        }   
                                                        
                                                    </div>

                                                    <div class="item">
                                                        @foreach (var item in Model.ImNews2)
    {
                                                    <div class="col-xs-3">
                                                        <div>
                                                            <a href="/Home/imagePreview/@item.Id">
                                                                <img src="~/Content/Content-image/@item.Url" onerror="this.src='/Content/Images/notFound.jpg'" />
                                                            </a>
                                                        </div>
                                                    </div>
    }
                                                    </div>
                                                </div>
                                            </div>




                                        </div>

                                </div>
                                   
                        <div class="col-sm-2 non-ul">
                            <div>
                                <h4>Быстрое меню</h4>
                                <hr />
                               
                                <ul>
                                    
                                    <li><a onclick="$('#img-tab').trigger('click')">Скачанные файлы</a></li>
                                    <li><a onclick="$('#plans-tab').trigger('click')">Мой баланс</a></li>
                                    <li><a href="/Home/License">Лицензия</a></li>
                                    <li><a href="/home/PhotoGalery">Новые коллекции</a></li>
                                </ul>
                            </div>
                            <br />
                            <div>
                                <h4>Бесплатное</h4>
                                <hr />
                                <div class="row">
                                    <ul class="inline">
                                        @foreach(var item in Model.ImFree)
                                        {
                                        <li><a href="/Home/ImagePreview/@item.Id"><img src="~/Content/Content-image/@item.Url" /></a></li>
                                        }
                                    </ul>
                                </div>

                            </div>
                            <br />
                            <div>
                                <h4>Чаще всего ищут:</h4>
                                <hr />
                                <div class="row">

                                    <ul  class="inline">
                                        @foreach(var item in Model.querysPopulars)
                                        {
                                        <li><a href="/Home/PhotoGalery?querys=@item.QueryStr">@item.QueryStr</a></li>
                                        }
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>






                </div>


                <div id="Images" class="tab-pane fade" >
                    @if (Model.buyings.Count() > 0)
    {
                <div class="row" id="quest0">

                    @foreach (var item in Model.buyings)
    {
                <div class="col-md-2 col-sm-3 col-xs-4">

                    <div style="width:100%;position:relative">
                        <a href="~/Home/ImagePreview/@item.ImageId">
                            <img src="~/Content/Content-image/@item.href" onerror="this.src='/Content/Images/deletedPict.jpg'"/>
                        </a>
                        <a href="/Manage/HideOrder/@item.OrderId" class="hideIm"><i class="fa fa-remove"></i></a>
                    </div>
                    <div>
                        <span style="float:left">@item.Size</span>
                        <span style="float:right">@item.OrdDate.ToShortDateString()</span>
                    </div>
                    <a href="@item.OrderId" style="margin-top:5px" class="btn btn-default redownload" download="">Скачать снова</a>
                </div>
}
                </div>
if (Model.buyingsAll.Count() > 0)
{


                <div class="row">
                    <div id="quest1" class="collapse">
                        @foreach (var item in Model.buyingsAll)
        {
                <div class="col-md-2 col-sm-3 col-xs-4" >

                    <div style="width:100%;position:relative">
                        <a href="~/Home/ImagePreview/@item.ImageId">
                            <img src="~/Content/Content-image/@item.href" onerror="this.src='/Content/Images/deletedPict.jpg'"/>
                        </a>
                        <a href="/Manage/HideOrder/@item.OrderId" class="hideIm"><i class="fa fa-remove"></i></a>
                    </div>
                    <div>
                        <span style="float:left">@item.Size</span>
                        <span style="float:right">@item.OrdDate.ToShortDateString()</span>
                    </div>
                    <a href="@item.OrderId" style="margin-top:5px" class="btn btn-default redownload" download="">Скачать снова</a>
                </div>
}


                    </div>
                </div>
                <p style="text-align:center">
                    <button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#quest1">
                        Показать все покупки
                    </button>
                </p>
}
else { }

}
else
{
                <div>
                    <img class="img-none-plI" src="~/Content/Images/notPlans.jpg" />
                </div>

                <a href="/home/PhotoGalery" class="btn btn-default">Перейти к фотогалерее</a>
}
                    <div class="row" id="user-likes">
                        <h4>Вам понравилось:</h4>
                        @if (Model.likings.Count() > 0)
                        {
                            foreach (var jl in Model.likings)
                            {
                                if (File.Exists(Server.MapPath("/Content/Content-image/") + jl.Url))
                                {
                <div>
                    <a href="/Home/ImagePreview/@jl.ImageId">
                        <img src="~/Content/Content-image/@jl.Url" />
                    </a>
                </div>
                                }
                            }
                        }
                        else
                        {
            <p>Отмечайте понравившиеся фотографии лайками, чтоб быстрее найти их в следующий раз.</p>
                        }
                    </div>

                </div>



                @*<div id="Plans" class="tab-pane fade">
                    
                    <div class="row" style="text-align:center; margin-top:30px">
                        <div class="navbar-right" style="text-align:right">
                            <h4>На вашем счету: <b>$@Model.userMoneys.MoneyBalance</b></h4>
                        @if (Model.userMoneys.MoneyBalance > 0)
                        {
                            <p>Последнее пополнение от @Model.userMoneys.LastDate.ToShortDateString()</p>
                        }
                        </div>
                    </div>
                    <hr />

                    <div class="row" style="text-align:center; margin-top:20px">
                        <h3 style="text-align:center">Планы:</h3>

                        @if (Model.plans.Count() > 0)
                        {
                        <table style="margin:16px 0;width:100%">
                            <tr>
                                <th style="text-align:center">План</th>
                                <th style="text-align:center">Стоимость</th>
                                <th style="text-align:center" class="hidden-column">Изображений изначально</th>
                                <th style="text-align:center">Остаток изображений</th>
                                <th style="text-align:center">Дата приобретения</th>
                                <th></th>
                            </tr>
                            @foreach(var item in Model.plans)
                            {
                            <tr>
                                <td>
                                    <span>
                                        @item.PlanId
                                    </span>
                                </td>
                                <td>
                                    <span>
                                        @item.StartPrice
                                    </span>
                                </td>
                                <td  class="hidden-column">
                                    @item.StartImageBalance
                                </td>
                                <td>
                                    @item.ImageBalance
                                </td>
                                <td>
                                    <span style="float:left">
                                        @item.BuyingDate
                                    </span>
                                </td>
                                <td>
                                    <span>
                                        <a class="hide-plan" href="@item.Id"><i class="fa fa-remove"></i></a>
                                    </span>
                                </td>
                            </tr>
                            }
                        </table>
                        }
                        else
                        {
                        <div>
                            <img src="~/Content/Images/notImages.jpg"class="img-none-plI" />
                        </div>

                        <a href="/Home/BuyPlan" class="btn btn-default">Ознакомиться с планами</a>
                        }
                    </div>
                </div>*@


                <div id="Profile" class="tab-pane fade">
                    <div class="row">

                        <div class="col-sm-4 col-xs-offset-1">
                            <div style="margin:auto;width: 224px;height: 224px;border-radius:153px;border: 1px solid #aaa;padding: 1px;">
                                <img src="@ViewBag.Logo" alt="Logo of user @Model.User.UserName" onerror="this.src='/Content/User-logo/raccoon.jpg'" style="object-fit:cover;width:220px;height:220px;border-radius: 152px;border: 3px solid #999;" />
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <span style="font-size: 30px;text-align:center;"><b>@Html.DisplayFor(model => model.User.UserName)</b></span>


                            <table style="margin:10px 0">
                                <tr>
                                    <td l>
                                        <span style="float:left">
                                            @Html.Label("Статус:")
                                        </span>
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.User.Status)
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span style="float:left">
                                            @Html.Label("О себе:")
                                        </span>
                                    </td>
                                    <td>
                                        @Html.DisplayFor(model => model.User.Additionally)
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span style="float:left">
                                            @Html.Label("Контакты:")
                                        </span>
                                    </td>
                                    <td>
                                        @if (Model.User.Site != null)
                                        {
                                            <a href="@Model.User.Site" @*target="_blank"*@>@ViewBag.ShortUrl</a>
                                        }
                                    </td>
                                </tr>
                            </table>
                            <div class="button-div">
                                <div class="col-xs-6" style="text-align:center">
                                    @Html.ActionLink("Смена пароля", "ChangePassword", "Account", new { @class = "btn btn-default" })
                                </div>
                                <div class="col-xs-6" style="text-align:center">
                                    @Html.ActionLink("Редактор профиля", "ChangeProfile", "Account", new { @class = "btn btn-default" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")
@section Scripts{
    @Scripts.Render("~/Scripts/jquery.unobtrusive-ajax.js");
    @*@Scripts.Render("~/Scripts/myImageManager.js");*@
    <script>
        $("a.hideIm").click(function (e) {
            e.preventDefault();
            $fj = this.href.substr(this.href.lastIndexOf('/')+1);
            var data = new FormData();
            data.append("Id", parseInt($fj));
            $.ajax({
                type: "POST",
                url: '/Manage/ImgHide',
                contentType: false,
                processData: false,
                data: data,
                success: function (result) {
                    location.reload();
                },
                error: function (xhr, status, p3) {
                    console.log(status.error);
                }
            });
        });
        $("a.hide-plan").click(function (e) {
            e.preventDefault();
            var data = new FormData();
            $fj = this.href.substr(this.href.lastIndexOf('/') + 1);
            var data = new FormData();
            data.append("Id", parseInt($fj));
            data.append("Id", parseInt(this.href));
            $.ajax({
                type: "POST",
                url: '/Manage/PlanHide',
                contentType: false,
                processData: false,
                data: data,
                success: function (result) {
                    location.reload();
                },
                error: function (xhr, status, p3) {
                    console.log(status.error);
                }
            });
        });
        
        $("a.redownload").click(function (e) {
            e.preventDefault();
            var data = new FormData();
            data.append("orderid", this.href.substr(this.href.lastIndexOf('/')+1));
            $.ajax({
                type: "POST",
                url:"/Manage/Redownload",
                contentType: false,
                processData: false,
                data: data,
                success: function (result) {
                    if (result.toString().lastIndexOf('0') > -1) {
                        alert("Ссылка на скачивание изображения отправлена на e-mail, указанный в Вашем профиле.");
                    }
                    else if (result.lastIndexOf('удалено') > -1) {
                        alert("Мы сожалеем, данное изображение удалено правообладателем.");
                    }
                },
                error: function (shr, status, p3) {
                    alert("Простите, из-за технического сбоя изображение не может быть отправлено.");
                }
            });
        });
    </script>
}







